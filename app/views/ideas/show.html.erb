<% stylesheet "show,comments" %>
<div class="idea_header">
  <div class="left" style="background-image: url('<%= @idea.images.first ? @idea.images.first.image.url(:med) : nil%>'); ">
  <div class="user">
    <div class="photo" style="background-image: url('<%= @idea.user.image ? @idea.user.image.url(:small) : nil %>')"></div>
    <div class="about">
        <fullname><%= @idea.user.full_name %></fullname>
        <div class="g-clear-20"></div>
        <department>Department: <%= @idea.user.department %> </department>
        <department>Title: <%=@idea.user.title %> </department>
        
    </div>

  </div>

  </div>

  <div class="right">
    <div class="center">
    <div class="joined"><b id="joined"><%= (1 + @idea.users.count).to_s %>  </b> <br/> joined </div>
    <div class="liked"><b id="likes"><%= @idea.likes %> </b> <br/> liked this</div>
  </div>
  <div class="g-clear-20"></div>
  <% if @idea.user != current_user %>
    <div class="center">
      <% if @idea.users.include?(current_user) %>
        <%= link_to 'Leave', unjoin_idea_path(@idea) , confirm: 'Are you sure?', class: "large green awesome" %>
      <% else %>
        <%= link_to 'Join', join_idea_path(@idea), :class=>"large green awesome" %>
      <% end %>

      <% if @idea.liked?(current_user) %>
      <% else %>
        <%= link_to 'Like', like_idea_path(@idea), class: "large green awesome", remote: true, id: "like_button" %>
      <% end %>
    </div>
  <% end %>
  </div>
</div>
<div class="g-clear"></div>
<div class="idea_content">
  <div class="left">
    <p id="notice"><%= notice %></p>

      <ideatitle>
        <%= @idea.title %>
        <% if @idea.user == current_user %>
          <%= link_to 'Edit', edit_idea_path(@idea) %>
        <% end %>
      </ideatitle>
      <ideaproblem>
        Problem: <%= @idea.problem %>
      </ideaproblem>
      <supporters>
        Participants:
        <% @idea.users.each do |user| %>
          <a href="<%=profile_path(:id=>user.id)%>"><img src="<%=user.image.url(:tiny) %>" width="25px" height="25px" /> </a>
        <% end %>
      </supporters>
  </div>
  <div class="right">
    Requirements<br/>
    <% if @idea.requirements %>
    <% @idea.requirements.split("\n").each do |req| %>
  
    <skill> <%=req %></skill>
    <% end %>
    <% end %>
  </div>
  <div class="g-clear"></div>
</div>

<div class="idea_description">
  <div>
      Solution: <%= @idea.solution %>
      <% if @idea.user == current_user %>
        <div class="g-clear-20"></div>
        <h3>Manage photos</h3>
        <%= form_for Image.new, :html => { :multipart => true } do |f| %>
          <%= f.file_field :image %>
          <%= f.hidden_field :idea_id, :value=>@idea.id %>
          <%= f.submit "Upload" %>
        <% end %>
          <% @idea.images.each do |i| %>
          <div>
            <img src="<%=  i.image.url(:thumb) %>" width="20px" height="20px" />
            <%= link_to 'Destroy', i, confirm: 'Are you sure?', method: :delete %>
          </div>
          <% end %>
    <% end %>


  </div>

  <div class="g-clear-20"></div>
</div>
<div class="comments">
  <div class="comment_form">
    <%= form_for(@comment) do |f| %>
      <% if @comment.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@comment.errors.count, "error") %> prohibited this comment from being saved:</h2>

          <ul>
          <% @comment.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
          </ul>
        </div>
      <% end %>
      <%= f.text_area :comment, :placeholder =>"Leave your comment" %>

      <%= f.hidden_field :idea_id, :value => @idea.id %>
        <%= f.submit "Post", :class=>"button" %>
    <% end %>
  </div>
  <div class="g-clear-20"></div>
  <%= render :partial => "shared/comment", :collection => @idea.comments %>

</div>

<br/>
